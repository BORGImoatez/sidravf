<!--
  STRUCTURE DES ONGLETS Ã€ INTÃ‰GRER DANS LE DASHBOARD-NATIONAL
  Remplacez la section <div class="charts-container"> par cette structure
-->

<div class="tabs-container" *ngIf="statistiques && !loading">
  <!-- En-tÃªte des onglets -->
  <div class="tabs-header">
    <button
      class="tab-button"
      [class.active]="activeTab === 'general'"
      (click)="switchTab('general')">
      Indicateurs GÃ©nÃ©raux
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'demographie'"
      (click)="switchTab('demographie')">
      DÃ©mographie
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'substances'"
      (click)="switchTab('substances')">
      Substances
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'sante'"
      (click)="switchTab('sante')">
      SantÃ©
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'demandes'"
      (click)="switchTab('demandes')">
      Demandes de Prise en Charge
    </button>
  </div>

  <!-- Contenu de l'onglet GÃ©nÃ©ral -->
  <div class="tab-content" [class.active]="activeTab === 'general'">
    <div class="charts-container">
      <!-- Cartes de situation familiale, motif consultation, etc. -->
      <div class="chart-card" *ngIf="situationFamilialeChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span> Situation Familiale</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="situationFamilialeChartData"
                  [type]="doughnutChartType"
                  [options]="doughnutChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card" *ngIf="motifConsultationChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ¥</span> Motif de Consultation</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="motifConsultationChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenu de l'onglet DÃ©mographie -->
  <div class="tab-content" [class.active]="activeTab === 'demographie'">
    <div class="charts-container">
      <div class="chart-card" *ngIf="sexeChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ‘¥</span> RÃ©partition par Sexe</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="sexeChartData"
                  [type]="doughnutChartType"
                  [options]="doughnutChartOptions">
          </canvas>
          <div class="stat-with-percentage" *ngIf="statistiques.repartitionSexe">
            <span class="stat-label">Hommes:</span>
            <div class="stat-value">
              <span class="stat-number">{{ statistiques.repartitionSexe.hommes | number }}</span>
              <span class="stat-percentage">
                {{ (statistiques.repartitionSexe.hommes * 100 / statistiques.totalConsultations).toFixed(1) }}%
              </span>
            </div>
          </div>
          <div class="stat-with-percentage" *ngIf="statistiques.repartitionSexe">
            <span class="stat-label">Femmes:</span>
            <div class="stat-value">
              <span class="stat-number">{{ statistiques.repartitionSexe.femmes | number }}</span>
              <span class="stat-percentage">
                {{ (statistiques.repartitionSexe.femmes * 100 / statistiques.totalConsultations).toFixed(1) }}%
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-card" *ngIf="ageChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ“Š</span> RÃ©partition par Tranche d'Ã‚ge</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="ageChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card wide" *ngIf="regionChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ—ºï¸</span> RÃ©partition par RÃ©gion</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="regionChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenu de l'onglet Substances -->
  <div class="tab-content" [class.active]="activeTab === 'substances'">
    <div class="charts-container">
      <div class="chart-card wide" *ngIf="substancesChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ’Š</span> Substances Psychoactives les Plus ConsommÃ©es</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="substancesChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card" *ngIf="frequenceTabacChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸš¬</span> FrÃ©quence Consommation - Tabac</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="frequenceTabacChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card" *ngIf="frequenceAlcoolChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ·</span> FrÃ©quence Consommation - Alcool</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="frequenceAlcoolChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card" *ngIf="voiesAdministrationChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ’‰</span> Voies d'Administration</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="voiesAdministrationChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenu de l'onglet SantÃ© -->
  <div class="tab-content" [class.active]="activeTab === 'sante'">
    <div class="charts-container">
      <div class="chart-card wide" *ngIf="testDepistageChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ§ª</span> Tests de DÃ©pistage</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="testDepistageChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card wide" *ngIf="hospitalisationsChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ¥</span> Hospitalisations LiÃ©es aux Drogues</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="hospitalisationsChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card" *ngIf="comorbiditeChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ¥</span> ComorbiditÃ©s</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="comorbiditeChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenu de l'onglet Demandes de Prise en Charge -->
  <div class="tab-content" [class.active]="activeTab === 'demandes'">
    <div class="stats-detail-section" *ngIf="statistiquesDemande">
      <h2 class="section-title">
        <span class="section-icon">ğŸ“‹</span>
        Statistiques des Demandes de Prise en Charge
      </h2>

      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-label">Total demandes</div>
          <div class="stat-value">{{ statistiquesDemande.totalDemandes | number }}</div>
        </div>

        <div class="stat-item">
          <div class="stat-label">Ã‚ge moyen</div>
          <div class="stat-value">{{ statistiquesDemande.moyenneAge.toFixed(1) }} <span class="unit">ans</span></div>
        </div>

        <div class="stat-item">
          <div class="stat-label">Ã‚ge mÃ©dian</div>
          <div class="stat-value">{{ statistiquesDemande.medianeAge.toFixed(1) }} <span class="unit">ans</span></div>
        </div>
      </div>
    </div>

    <div class="charts-container" *ngIf="statistiquesDemande">
      <!-- RÃ©partition par Sexe -->
      <div class="chart-card" *ngIf="demandeSexeChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ‘¥</span> RÃ©partition par Sexe</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="demandeSexeChartData"
                  [type]="doughnutChartType"
                  [options]="doughnutChartOptions">
          </canvas>
          <div class="stat-with-percentage">
            <span class="stat-label">Hommes:</span>
            <div class="stat-value">
              <span class="stat-number">{{ statistiquesDemande.repartitionSexe.hommes | number }}</span>
              <span class="stat-percentage">{{ statistiquesDemande.repartitionSexe.pourcentageHommes.toFixed(1) }}%</span>
            </div>
          </div>
          <div class="stat-with-percentage">
            <span class="stat-label">Femmes:</span>
            <div class="stat-value">
              <span class="stat-number">{{ statistiquesDemande.repartitionSexe.femmes | number }}</span>
              <span class="stat-percentage">{{ statistiquesDemande.repartitionSexe.pourcentageFemmes.toFixed(1) }}%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Auteurs des Demandes -->
      <div class="chart-card" *ngIf="demandeAuteursChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ‘¤</span> Auteurs des Demandes</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="demandeAuteursChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
          <div *ngFor="let auteur of statistiquesDemande.auteursDemandes" class="stat-with-percentage">
            <span class="stat-label">{{ auteur.auteur }}:</span>
            <div class="stat-value">
              <span class="stat-number">{{ auteur.nombre | number }}</span>
              <span class="stat-percentage">{{ auteur.pourcentage.toFixed(1) }}%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Certificats MÃ©dicaux -->
      <div class="chart-card" *ngIf="demandeCertificatsChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ“„</span> Certificats MÃ©dicaux</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="demandeCertificatsChartData"
                  [type]="doughnutChartType"
                  [options]="doughnutChartOptions">
          </canvas>
          <div *ngFor="let cert of statistiquesDemande.certificatsMedicaux" class="stat-with-percentage">
            <span class="stat-label">{{ cert.type }}:</span>
            <div class="stat-value">
              <span class="stat-number">{{ cert.nombre | number }}</span>
              <span class="stat-percentage">{{ cert.pourcentage.toFixed(1) }}%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- RÃ©partition par Gouvernorat -->
      <div class="chart-card wide" *ngIf="demandeGouvernoratChartData">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ—ºï¸</span> RÃ©partition par Gouvernorat</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="demandeGouvernoratChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>

          <div class="gouvernorat-selector" style="margin-top: 20px;">
            <label style="font-weight: 600; margin-bottom: 10px; display: block;">
              SÃ©lectionnez un gouvernorat pour voir les dÃ©tails par dÃ©lÃ©gation:
            </label>
            <select
              [(ngModel)]="selectedGouvernorat"
              (change)="selectGouvernoratForDelegation(selectedGouvernorat!)"
              style="padding: 8px; border-radius: 8px; border: 1px solid #dee2e6; width: 100%;">
              <option [value]="null">-- Choisir un gouvernorat --</option>
              <option *ngFor="let gouv of statistiquesDemande.parGouvernorat" [value]="gouv.gouvernorat">
                {{ gouv.gouvernorat }} ({{ gouv.nombre }} demandes - {{ gouv.pourcentage.toFixed(1) }}%)
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Histogramme par DÃ©lÃ©gation -->
      <div class="chart-card wide" *ngIf="demandeDelegationChartData && selectedGouvernorat">
        <div class="chart-header">
          <h3><span class="chart-icon">ğŸ“</span> RÃ©partition par DÃ©lÃ©gation - {{ selectedGouvernorat }}</h3>
        </div>
        <div class="chart-body">
          <canvas baseChart
                  [data]="demandeDelegationChartData"
                  [type]="barChartType"
                  [options]="barChartOptions">
          </canvas>
        </div>
      </div>
    </div>
  </div>
</div>
